{"version":3,"file":"utils.js","sources":["uni_modules/uview-plus/components/u-upload/utils.js"],"sourcesContent":["function pickExclude(obj, keys) {\r\n\t// 某些情况下，type可能会为\r\n    if (!['[object Object]', '[object File]'].includes(Object.prototype.toString.call(obj))) {\r\n        return {}\r\n    }\r\n    return Object.keys(obj).reduce((prev, key) => {\r\n        if (!keys.includes(key)) {\r\n            prev[key] = obj[key]\r\n        }\r\n        return prev\r\n    }, {})\r\n}\r\n\r\nfunction formatImage(res) {\r\n    return res.tempFiles.map((item) => ({\r\n        ...pickExclude(item, ['path']),\r\n        type: 'image',\r\n        url: item.path,\r\n        thumb: item.path,\r\n\t\tsize: item.size,\r\n\t\t// #ifdef H5\r\n\t\tname: item.name,\r\n\t\tfile: item\r\n\t\t// #endif\r\n    }))\r\n}\r\n\r\nfunction formatVideo(res) {\r\n    return [\r\n        {\r\n            ...pickExclude(res, ['tempFilePath', 'thumbTempFilePath', 'errMsg']),\r\n            type: 'video',\r\n            url: res.tempFilePath,\r\n            thumb: res.thumbTempFilePath,\r\n\t\t\tsize: res.size,\r\n\t\t\t// #ifdef H5\r\n\t\t\tname: res.name,\r\n\t\t\tfile: res\r\n\t\t\t// #endif\r\n        }\r\n    ]\r\n}\r\n\r\nfunction formatMedia(res) {\r\n    return res.tempFiles.map((item) => ({\r\n        ...pickExclude(item, ['fileType', 'thumbTempFilePath', 'tempFilePath']),\r\n        type: res.type,\r\n        url: item.tempFilePath,\r\n        thumb: res.type === 'video' ? item.thumbTempFilePath : item.tempFilePath,\r\n\t\tsize: item.size,\r\n\t\t// #ifdef H5\r\n\t\tfile: item\r\n\t\t// #endif\r\n    }))\r\n}\r\n\r\nfunction formatFile(res) {\r\n    return res.tempFiles.map((item) => ({ \r\n\t\t...pickExclude(item, ['path']), \r\n\t\turl: item.path, \r\n\t\tsize:item.size,\r\n\t\t// #ifdef H5\r\n\t\tname: item.name,\r\n\t\ttype: item.type,\r\n\t\tfile: item\r\n\t\t// #endif \r\n\t}))\r\n}\r\nexport function chooseFile({\r\n    accept,\r\n    multiple,\r\n    capture,\r\n    compressed,\r\n    maxDuration,\r\n    sizeType,\r\n    camera,\r\n    maxCount,\r\n    extension\r\n}) {\r\n    return new Promise((resolve, reject) => {\r\n        switch (accept) {\r\n        case 'image':\r\n            uni.chooseImage({\r\n                count: multiple ? Math.min(maxCount, 9) : 1,\r\n                sourceType: capture,\r\n                sizeType,\r\n                success: (res) => resolve(formatImage(res)),\r\n                fail: reject\r\n            })\r\n            break\r\n            // #ifdef MP-WEIXIN\r\n            // 只有微信小程序才支持chooseMedia接口\r\n        case 'media':\r\n            wx.chooseMedia({\r\n                count: multiple ? Math.min(maxCount, 9) : 1,\r\n                sourceType: capture,\r\n                maxDuration,\r\n                sizeType,\r\n                camera,\r\n                success: (res) => resolve(formatMedia(res)),\r\n                fail: reject\r\n            })\r\n            break\r\n            // #endif\r\n        case 'video':\r\n            uni.chooseVideo({\r\n                sourceType: capture,\r\n                compressed,\r\n                maxDuration,\r\n                camera,\r\n                success: (res) => resolve(formatVideo(res)),\r\n                fail: reject\r\n            })\r\n            break\r\n            // #ifdef MP-WEIXIN || H5\r\n            // 只有微信小程序才支持chooseMessageFile接口\r\n        case 'file':\r\n            // #ifdef MP-WEIXIN\r\n            wx.chooseMessageFile({\r\n                count: multiple ? maxCount : 1,\r\n                type: accept,\r\n                success: (res) => resolve(formatFile(res)),\r\n                fail: reject\r\n            })\r\n            // #endif\r\n            // #ifdef H5\r\n            // 需要hx2.9.9以上才支持uni.chooseFile\r\n            let params = {\r\n                count: multiple ? maxCount : 1,\r\n                type: accept,\r\n                success: (res) => resolve(formatFile(res)),\r\n                fail: reject\r\n            }\r\n            if (extension.length && extension.length > 0) {\r\n                params.extension = extension\r\n            }\r\n            uni.chooseFile(params)\r\n            // #endif\r\n            break\r\n\t\t\t\t// #endif\r\n\t\tdefault: \r\n\t\t\t// 此为保底选项，在accept不为上面任意一项的时候选取全部文件\r\n\t\t\t// #ifdef MP-WEIXIN\r\n\t\t\twx.chooseMessageFile({\r\n\t\t\t    count: multiple ? maxCount : 1,\r\n\t\t\t    type: 'all',\r\n\t\t\t    success: (res) => resolve(formatFile(res)),\r\n\t\t\t    fail: reject\r\n\t\t\t})\r\n\t\t\t// #endif\r\n\t\t\t// #ifdef H5\r\n\t\t\t// 需要hx2.9.9以上才支持uni.chooseFile\r\n            let paramsFile = {\r\n                count: multiple ? maxCount : 1,\r\n\t\t\t\ttype: 'all',\r\n\t\t\t\tsuccess: (res) => resolve(formatFile(res)),\r\n\t\t\t\tfail: reject\r\n            }\r\n            if (extension.length && extension.length > 0) {\r\n                paramsFile.extension = extension\r\n            }\r\n\t\t\tuni.chooseFile(paramsFile)\r\n\t\t\t// #endif\r\n        }\r\n    })\r\n}\r\n"],"names":["uni","wx"],"mappings":";;AAAA,SAAS,YAAY,KAAK,MAAM;AAE5B,MAAI,CAAC,CAAC,mBAAmB,eAAe,EAAE,SAAS,OAAO,UAAU,SAAS,KAAK,GAAG,CAAC,GAAG;AACrF,WAAO,CAAE;AAAA,EACZ;AACD,SAAO,OAAO,KAAK,GAAG,EAAE,OAAO,CAAC,MAAM,QAAQ;AAC1C,QAAI,CAAC,KAAK,SAAS,GAAG,GAAG;AACrB,WAAK,GAAG,IAAI,IAAI,GAAG;AAAA,IACtB;AACD,WAAO;AAAA,EACV,GAAE,EAAE;AACT;AAEA,SAAS,YAAY,KAAK;AACtB,SAAO,IAAI,UAAU,IAAI,CAAC,UAAU;AAAA,IAChC,GAAG,YAAY,MAAM,CAAC,MAAM,CAAC;AAAA,IAC7B,MAAM;AAAA,IACN,KAAK,KAAK;AAAA,IACV,OAAO,KAAK;AAAA,IAClB,MAAM,KAAK;AAAA,EAKb,EAAM;AACN;AAEA,SAAS,YAAY,KAAK;AACtB,SAAO;AAAA,IACH;AAAA,MACI,GAAG,YAAY,KAAK,CAAC,gBAAgB,qBAAqB,QAAQ,CAAC;AAAA,MACnE,MAAM;AAAA,MACN,KAAK,IAAI;AAAA,MACT,OAAO,IAAI;AAAA,MACpB,MAAM,IAAI;AAAA,IAKJ;AAAA,EACJ;AACL;AAEA,SAAS,YAAY,KAAK;AACtB,SAAO,IAAI,UAAU,IAAI,CAAC,UAAU;AAAA,IAChC,GAAG,YAAY,MAAM,CAAC,YAAY,qBAAqB,cAAc,CAAC;AAAA,IACtE,MAAM,IAAI;AAAA,IACV,KAAK,KAAK;AAAA,IACV,OAAO,IAAI,SAAS,UAAU,KAAK,oBAAoB,KAAK;AAAA,IAClE,MAAM,KAAK;AAAA,EAIb,EAAM;AACN;AAEA,SAAS,WAAW,KAAK;AACrB,SAAO,IAAI,UAAU,IAAI,CAAC,UAAU;AAAA,IACtC,GAAG,YAAY,MAAM,CAAC,MAAM,CAAC;AAAA,IAC7B,KAAK,KAAK;AAAA,IACV,MAAK,KAAK;AAAA,EAMZ,EAAG;AACH;AACO,SAAS,WAAW;AAAA,EACvB;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACJ,GAAG;AACC,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpC,YAAQ,QAAM;AAAA,MACd,KAAK;AACDA,sBAAAA,MAAI,YAAY;AAAA,UACZ,OAAO,WAAW,KAAK,IAAI,UAAU,CAAC,IAAI;AAAA,UAC1C,YAAY;AAAA,UACZ;AAAA,UACA,SAAS,CAAC,QAAQ,QAAQ,YAAY,GAAG,CAAC;AAAA,UAC1C,MAAM;AAAA,QACtB,CAAa;AACD;AAAA,MAGJ,KAAK;AACDC,sBAAAA,KAAG,YAAY;AAAA,UACX,OAAO,WAAW,KAAK,IAAI,UAAU,CAAC,IAAI;AAAA,UAC1C,YAAY;AAAA,UACZ;AAAA,UACA;AAAA,UACA;AAAA,UACA,SAAS,CAAC,QAAQ,QAAQ,YAAY,GAAG,CAAC;AAAA,UAC1C,MAAM;AAAA,QACtB,CAAa;AACD;AAAA,MAEJ,KAAK;AACDD,sBAAAA,MAAI,YAAY;AAAA,UACZ,YAAY;AAAA,UACZ;AAAA,UACA;AAAA,UACA;AAAA,UACA,SAAS,CAAC,QAAQ,QAAQ,YAAY,GAAG,CAAC;AAAA,UAC1C,MAAM;AAAA,QACtB,CAAa;AACD;AAAA,MAGJ,KAAK;AAEDC,sBAAAA,KAAG,kBAAkB;AAAA,UACjB,OAAO,WAAW,WAAW;AAAA,UAC7B,MAAM;AAAA,UACN,SAAS,CAAC,QAAQ,QAAQ,WAAW,GAAG,CAAC;AAAA,UACzC,MAAM;AAAA,QACtB,CAAa;AAeD;AAAA,MAEV;AAGCA,sBAAAA,KAAG,kBAAkB;AAAA,UACjB,OAAO,WAAW,WAAW;AAAA,UAC7B,MAAM;AAAA,UACN,SAAS,CAAC,QAAQ,QAAQ,WAAW,GAAG,CAAC;AAAA,UACzC,MAAM;AAAA,QACb,CAAI;AAAA,IAeK;AAAA,EACT,CAAK;AACL;;"}